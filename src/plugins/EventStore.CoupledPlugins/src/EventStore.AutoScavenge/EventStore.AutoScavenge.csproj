<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<TargetFramework>net8.0</TargetFramework>
		<ImplicitUsings>enable</ImplicitUsings>
		<Nullable>enable</Nullable>
		<EnableDynamicLoading>true</EnableDynamicLoading>
	</PropertyGroup>

	<ItemGroup>
		<ProjectReference Include="..\EventStore.POC.ConnectedSubsystemHost\EventStore.POC.ConnectedSubsystemHost.csproj" />
		<ProjectReference Include="..\EventStore.POC.ConnectedSubsystemsPlugin\EventStore.POC.ConnectedSubsystemsPlugin.csproj" />
		<ProjectReference Include="..\EventStore.POC.IO.Core\EventStore.POC.IO.Core.csproj" />
	</ItemGroup>

	<ItemGroup>
	  <PackageReference Include="NCrontab" Version="3.3.3" />
	</ItemGroup>


	<Target Name="PostBuild" AfterTargets="PostBuildEvent">
		<ItemGroup>
			<MySourceFiles Include="$(OutDir)\*.AutoScavenge.*" />
			<MySourceFiles Include="$(OutDir)\NCrontab.dll" />
		</ItemGroup>
		<Copy SourceFiles="@(MySourceFiles)" DestinationFolder="..\..\EventStore\src\EventStore.ClusterNode\$(OutDir)\plugins\$(ProjectName)" />
	</Target>

	<Target Name="PublishPlugin" AfterTargets="Publish">
		<ItemGroup>
			<PluginOutputFiles Include="$(PublishDir)\LICENSE.md" />
			<PluginOutputFiles Include="$(PublishDir)\NOTICE.html" />
			<PluginOutputFiles Include="$(PublishDir)\EventStore.AutoScavenge.deps.json" />
			<PluginOutputFiles Include="$(PublishDir)\EventStore.AutoScavenge.dll" />
			<PluginOutputFiles Include="$(PublishDir)\NCrontab.dll*" />
		</ItemGroup>
		<Copy SourceFiles="@(PluginOutputFiles)" DestinationFolder="$(PublishDir)/package" />
	</Target>
</Project>
