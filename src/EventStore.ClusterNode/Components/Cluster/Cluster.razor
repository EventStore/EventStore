@page "/ui/cluster"
@implements IDisposable
@using EventStore.Core.Bus
@using EventStore.ClusterNode.Services
@using EventStore.ClusterNode.Components.Cluster.Monitoring
@inject IPublisher Publisher
@inject MonitoringService MonitoringService

<PageTitle>KurrentDB: Cluster</PageTitle>

<MudGrid>
	<MudItem xs="12">
		<MudCard Class="ma-2">
			<MudCardHeader>
				<CardHeaderAvatar>
					<MudAvatar Color="@ClusterIconColor">
						<MudIcon Icon="@ClusterIcon"/>
					</MudAvatar>
				</CardHeaderAvatar>
				<CardHeaderContent>
					<MudText Typo="Typo.body1">Server
						address: @_clusterInfo?.ServerIp:@_clusterInfo?.ServerPort</MudText>
				</CardHeaderContent>
				<CardHeaderActions>
					@* <MudIconButton Icon="@Icons.Material.Filled.Settings" Color="Color.Default"/> *@
				</CardHeaderActions>
			</MudCardHeader>
			<MudCardContent>
				<MudText>OS: @LocalOs</MudText>
			</MudCardContent>
		</MudCard>
	</MudItem>
	@foreach (var member in _clusterInfo?.Members ?? []) {
		<MudItem xs="@CardWidth">
			<ClusterMember Member="member"></ClusterMember>
		</MudItem>
	}
	<MudItem>
		<MudPaper Width="300px" Height="300px" Class="pa-16 ma-2" Outlined="true">
			<MudText Typo="Typo.h5" Align="Align.Center">Connections</MudText>
			<MudText Typo="Typo.h3" Align="Align.Center"
			         Color="Color.Primary">@MonitoringService.ActiveConnections</MudText>
		</MudPaper>
	</MudItem>
	<MudItem>
		<MetricDonut Value="@_cpu" Name="CPU"></MetricDonut>
	</MudItem>
	<MudItem>
		<MetricDonut Value="@_ram" Name="Memory"></MetricDonut>
	</MudItem>
	<MudItem>
		<MudPaper Class="pa-16 ma-2" Outlined="true"></MudPaper>
	</MudItem>
	<MudItem xs="6">
		<MudPaper Outlined="true">
			<MudTimeSeriesChart
				ChartSeries="@_series"
				@bind-SelectedIndex="_index"
				Width="100%"
				Height="350px"
				ChartOptions="@_options"
				CanHideSeries
				TimeLabelSpacing="TimeSpan.FromMinutes(5)"/>
		</MudPaper>
	</MudItem>
</MudGrid>
