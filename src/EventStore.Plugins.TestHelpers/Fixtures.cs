// Copyright (c) Kurrent, Inc and/or licensed to Kurrent, Inc under one or more agreements.
// Kurrent, Inc licenses this file to you under the Kurrent License v1 (see LICENSE.md).

using System.Reactive.Subjects;
using EventStore.Plugins.Licensing;
using Microsoft.IdentityModel.JsonWebTokens;

namespace EventStore.Plugins.TestHelpers;

public static class Fixtures {
	static readonly Dictionary<string, string> _hardCodedTokens = new() {
		{ "AUTO_SCAVENGE", "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJlc2RiIiwiaXNzIjoiZXNkYiIsImV4cCI6MTgyNDQ1NjgyOCwianRpIjoiMTU3NDk2N2MtMmVkNC00OGZhLWIyNjItYTdhMGQzYTA1NTczIiwic3ViIjoiRVNEQiBUZXN0cyIsIklzVHJpYWwiOiJUcnVlIiwiSXNFeHBpcmVkIjoiRmFsc2UiLCJJc1ZhbGlkIjoiVHJ1ZSIsIklzRmxvYXRpbmciOiJUcnVlIiwiRGF5c1JlbWFpbmluZyI6IjEiLCJTdGFydERhdGUiOiIyNi8wNC8yMDI0IDAwOjAwOjAwICswMTowMCIsIkFVVE9fU0NBVkVOR0UiOiJ0cnVlIiwiaWF0IjoxNzI5ODQ4ODI4LCJuYmYiOjE3Mjk4NDg4Mjh9.jaQ58MxlqM2oORJw9bWJzvdTzwWxFeo-624SMN52Rm2j6HLvWsT2_jFTb_Xi-rXmP1C7KlJCQEMhksV_5QdsiRi37oao1fcxfywOBHQkPMqx2Hd1CMWq1_DAY0az12fRSrR9h3L_yIiez2coRNFKkc5mZSq2KHoZre0WWXbMUDL1RheG1KNTxL2qBelyYVMYRZ7lXfsUpgzahOTR36QTtWYETBbtzik8ZujINhYGUhqbGLtGO3Ad3kTqPQVB6MMDNgE6F-ZHLMrXPR08fJNYrkxcB8WoSbelzPduPN6tMJeyn1e6jYO3oOUBZZsD2tdX_Pai1qw4fiZlZlPycbYOBQ" },
		{ "ENCRYPTION_AT_REST", "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJlc2RiIiwiaXNzIjoiZXNkYiIsImV4cCI6MTgyNDQ1NjgyOSwianRpIjoiOTBiOWJkMGItZDQ3NS00NGQ0LWI2MjQtYjRiNzU1ZWI0ZmMxIiwic3ViIjoiRVNEQiBUZXN0cyIsIklzVHJpYWwiOiJUcnVlIiwiSXNFeHBpcmVkIjoiRmFsc2UiLCJJc1ZhbGlkIjoiVHJ1ZSIsIklzRmxvYXRpbmciOiJUcnVlIiwiRGF5c1JlbWFpbmluZyI6IjEiLCJTdGFydERhdGUiOiIyNi8wNC8yMDI0IDAwOjAwOjAwICswMTowMCIsIkVOQ1JZUFRJT05fQVRfUkVTVCI6InRydWUiLCJpYXQiOjE3Mjk4NDg4MjksIm5iZiI6MTcyOTg0ODgyOX0.AOMV7xhVds03oOdIhKQWRezooJl5tGtt4vGXmtq7cAzuoze5CC93svfJwYIui0Y5CG5yP32qEY-4YI7w41aROEEWXXa7DvWaefk2h-3a7zcrtol24klkmoscKkylAEy9xuxarqDaUh0Z2ooILuq1JmNnGKbzxGQ_khZKqS5-OpYVzcGY0iNpK49Td-ue5pPrJ7meuEHUJWWudw7Wv9MzUo1lR40bRqFn0xHUXeA4KDHQPAhjOVp_1isVTN7eWGq00Rz-c-8JT-4Beg7yFfVg0Vr2rHvxbWvk32BOHhHxHxUlfbzhLzAkpUQoZqRSWdjL3fvpeEhXsHD-riw1uIxZRA" },
		{ "LDAPS_AUTHENTICATION", "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJlc2RiIiwiaXNzIjoiZXNkYiIsImV4cCI6MTgyNDQ1NjgyOSwianRpIjoiZDc0OWM3ODAtNWIyNi00ZDlkLTljMzctMGI4ZTVmZDg2MDgwIiwic3ViIjoiRVNEQiBUZXN0cyIsIklzVHJpYWwiOiJUcnVlIiwiSXNFeHBpcmVkIjoiRmFsc2UiLCJJc1ZhbGlkIjoiVHJ1ZSIsIklzRmxvYXRpbmciOiJUcnVlIiwiRGF5c1JlbWFpbmluZyI6IjEiLCJTdGFydERhdGUiOiIyNi8wNC8yMDI0IDAwOjAwOjAwICswMTowMCIsIkxEQVBTX0FVVEhFTlRJQ0FUSU9OIjoidHJ1ZSIsImlhdCI6MTcyOTg0ODgyOSwibmJmIjoxNzI5ODQ4ODI5fQ.GOLUghP1kht56zWXYj4-A1nilRlCfrjIWP5gTUjh1UA1cbDuMqOn-UfddM2GnesBz07PbwOt6vgZwHvhyO1CU2w-sAGpZKTykZ9Jj5lk_TZ068yDcEUBDcfk1v-Zc_wlG9GYzr8WssXkAs0O1L1vdsVB3R2G_ZtmU_TYtN93ojQVMrMt6ZzvxkZTe-dMgsycXXBOS1tSi_IkwagawtMJCogGaUHdsnlWdzFVZkcpOiIHCZl1aoP30uDxSLKC8VKHoqnZWSo2AXVLeoJpoVLm4lr86AIGGtg5FNzVsFcPpzfdHau5DSfFeHfhpXMislbCO4Lzdd2khKVPDjiaVRLXFA" },
		{ "LEGACY_AUTHORIZATION_WITH_STREAM_AUTHORIZATION_DISABLED", "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJlc2RiIiwiaXNzIjoiZXNkYiIsImV4cCI6MTgyNDQ1NjgyOSwianRpIjoiMjI0MTI5NzEtNjlhZS00YzZmLWFmNDktNGNjN2IwY2UzZWI0Iiwic3ViIjoiRVNEQiBUZXN0cyIsIklzVHJpYWwiOiJUcnVlIiwiSXNFeHBpcmVkIjoiRmFsc2UiLCJJc1ZhbGlkIjoiVHJ1ZSIsIklzRmxvYXRpbmciOiJUcnVlIiwiRGF5c1JlbWFpbmluZyI6IjEiLCJTdGFydERhdGUiOiIyNi8wNC8yMDI0IDAwOjAwOjAwICswMTowMCIsIkxFR0FDWV9BVVRIT1JJWkFUSU9OX1dJVEhfU1RSRUFNX0FVVEhPUklaQVRJT05fRElTQUJMRUQiOiJ0cnVlIiwiaWF0IjoxNzI5ODQ4ODI5LCJuYmYiOjE3Mjk4NDg4Mjl9.a1uKQrzBhzulOlM69HB44g3pDTW9B9OdJ01QDrqxiIBlBy1pmsZAMIk4e29eQBWcOUyd5V5LnjJyqGPp8TBa9Y-co5ul-3cD3-HkEazsrYo4gJrRZsShCUJpIxzMWuRLrm6UnPhwFEQplm18KHPjg-j3M7_DQV6kwsJa_fCCNrc-61WIwaheFcoZqq8puKjQRFSUsamKnixamHtJ0i6DOlMmhxfb_8KDL0LTzLceGeP_bIodYUJm-G0upaks_Q8ZmKS2lPQjlfIz570y7m7vTqQYkGkkKKvmrYY6rrtZMJX33dHBLljywQoP6oMyZDrGKs-MQfKnQZz6OiwKHxxfig" },
		{ "LOGS_ENDPOINT", "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJlc2RiIiwiaXNzIjoiZXNkYiIsImV4cCI6MTgyNDQ1NjgyOSwianRpIjoiMzVhOWY4N2YtMTc1YS00MjZhLWIzNjYtNGYyY2FlZDliYmFhIiwic3ViIjoiRVNEQiBUZXN0cyIsIklzVHJpYWwiOiJUcnVlIiwiSXNFeHBpcmVkIjoiRmFsc2UiLCJJc1ZhbGlkIjoiVHJ1ZSIsIklzRmxvYXRpbmciOiJUcnVlIiwiRGF5c1JlbWFpbmluZyI6IjEiLCJTdGFydERhdGUiOiIyNi8wNC8yMDI0IDAwOjAwOjAwICswMTowMCIsIkxPR1NfRU5EUE9JTlQiOiJ0cnVlIiwiaWF0IjoxNzI5ODQ4ODI5LCJuYmYiOjE3Mjk4NDg4Mjl9.MxD5X7zh4MdWSgX6CncwVvf_6EFRoXEDwwrnQ1CSqAmHv0rCxvjqZKNjBhWDWWO_z1O_JtQ71Mkt1TCbTYKHMHf_v8Sp45kzojF3BirdFHfL_pqlDO4hhwNuzuL58Xzy9TO6bMUJrQMLuRSMqoYDDthP8uUBCS8IGa2dEm_knpKReZLIrG8qQ3Mmx1wUkuHKJVvh_5WB5mvg9GvDPBcw4R929lYy-qSP23SsXDbRF38vST7oODrvhNNv3ECA8Oo11FdbfpDnm2zzf7lAun8kwrsRD70NrYnO0kydbdikyFTbvS2p0_yG1mtfMkKgriO2SsLLshjYlzUmPZvUQzRSKA" },
		{ "MD5", "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJlc2RiIiwiaXNzIjoiZXNkYiIsImV4cCI6MTgyNDQ1NjgyOSwianRpIjoiNzljMjFiZGItMGQ2Mi00MDJkLTlmNjYtYjBhYzE1NmExZjhiIiwic3ViIjoiRVNEQiBUZXN0cyIsIklzVHJpYWwiOiJUcnVlIiwiSXNFeHBpcmVkIjoiRmFsc2UiLCJJc1ZhbGlkIjoiVHJ1ZSIsIklzRmxvYXRpbmciOiJUcnVlIiwiRGF5c1JlbWFpbmluZyI6IjEiLCJTdGFydERhdGUiOiIyNi8wNC8yMDI0IDAwOjAwOjAwICswMTowMCIsIk1ENSI6InRydWUiLCJpYXQiOjE3Mjk4NDg4MjksIm5iZiI6MTcyOTg0ODgyOX0.DtiaMagnEbVSCVbJbOjhY8VYfojfiYlg1P8rPshw-DCvUmNG9QHLs_EJYZAWzUoMgQKt1UEa6a-mITqT6aTzyVAXnHRGcqEEaiQATHjWueFSm7NXfMvdthJFhh__vcqYbaqPBVAtuGsNval2PhqecXf1YnpwzGjlOJQm2weEmrD1i643r6T-OgDHPxC2hAh5wc9hy_dd0Xkgp_bdQ96RbB6yxUDjyF8KWJlZ0I6dVZXnoJnYwIhG6RARiPfX1JaqJsEWaL1sAAITygINqxooXNBjKTWQlgAZbT9jg59A4UB38YAhG6IZAhCzBQJVhWzw0DfBApE7Roeg9og2MWqAPA" },
		{ "OAUTH_AUTHENTICATION", "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJlc2RiIiwiaXNzIjoiZXNkYiIsImV4cCI6MTgyNDQ1NjgyOSwianRpIjoiYzZmMDQ1NDQtNzkwZS00MTBiLTg5NjMtNzdlNmUzZjA2ZDAyIiwic3ViIjoiRVNEQiBUZXN0cyIsIklzVHJpYWwiOiJUcnVlIiwiSXNFeHBpcmVkIjoiRmFsc2UiLCJJc1ZhbGlkIjoiVHJ1ZSIsIklzRmxvYXRpbmciOiJUcnVlIiwiRGF5c1JlbWFpbmluZyI6IjEiLCJTdGFydERhdGUiOiIyNi8wNC8yMDI0IDAwOjAwOjAwICswMTowMCIsIk9BVVRIX0FVVEhFTlRJQ0FUSU9OIjoidHJ1ZSIsImlhdCI6MTcyOTg0ODgyOSwibmJmIjoxNzI5ODQ4ODI5fQ.LArwI3dhiQNbTtCiUfjW_9IDpbeVyAGrFOnClNOrremg1zgbpRjZ0Erumi6TGx7kWaTmmutqFXKGdp0xiFyMZEv7tK9Lyf1gZeqN4pnoTFjPMU1hzVzqUR9pqG8tBsPWxWNLck0DyBiQ3FPgexmleAVCoYicXiV7bYiw_rrHYjTZ5jQnuApCmQhjPiYg6XGsVS-8sH1IgcVYE_R3hkEne93XFqLyXbUNW1oBIU16UjURnMEwZFlN2m_pJkfo445AHNH-TUxwwkJOcU9ha4Nd2mPWR9lZ82HPZp5rCeNCChgrMck4zOIE2Hpu_JqVCsC8F3FCS5oUQauXSNAQKJC6mg" },
		{ "OTLP_EXPORTER", "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJlc2RiIiwiaXNzIjoiZXNkYiIsImV4cCI6MTgyNDQ1NjgyOSwianRpIjoiM2ZlMzg5NjAtMWRmNC00ZjFhLTlkY2EtNTU2Mjc0MTZhOGQ2Iiwic3ViIjoiRVNEQiBUZXN0cyIsIklzVHJpYWwiOiJUcnVlIiwiSXNFeHBpcmVkIjoiRmFsc2UiLCJJc1ZhbGlkIjoiVHJ1ZSIsIklzRmxvYXRpbmciOiJUcnVlIiwiRGF5c1JlbWFpbmluZyI6IjEiLCJTdGFydERhdGUiOiIyNi8wNC8yMDI0IDAwOjAwOjAwICswMTowMCIsIk9UTFBfRVhQT1JURVIiOiJ0cnVlIiwiaWF0IjoxNzI5ODQ4ODI5LCJuYmYiOjE3Mjk4NDg4Mjl9.nPGgyP4qGz6fzbTXFbBc_vplJ-nN_nXXDnMBXQ3Qr8e8QFCSrkikHtx1qKurtg2YVMDdAuXsKAFnU7M3iuCIuRESfSfseonMeVCNOhf6S4ziyffCeBvmDhw6lyDQ-BsGCzsuSpMwslZXfhqR7GXkbwojA4HsKEaSqK1ifzbmfsYlfZGa0MdMnBMLGfI_hGzDkOi4ALMfAHvPN9fo8Gru7LZyMOGTkDtN00BI0XDT71dnGylYjXLa15pO2HfHAi09fAZAamelghPc4cBuz6kliFhqDhnaQ8m-EE_q7BrCtEyQvJbOcA9Jv_hsA4nKhzAriNyzKbDZQS82FbAGgObMBw" },
		{ "STREAM_POLICY_AUTHORIZATION", "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJlc2RiIiwiaXNzIjoiZXNkYiIsImV4cCI6MTgyNDQ1NjgyOSwianRpIjoiMmIzMjlmOWMtNGFlZC00ZDlkLWJjOTEtYTQ4YWFkZWRiNTE0Iiwic3ViIjoiRVNEQiBUZXN0cyIsIklzVHJpYWwiOiJUcnVlIiwiSXNFeHBpcmVkIjoiRmFsc2UiLCJJc1ZhbGlkIjoiVHJ1ZSIsIklzRmxvYXRpbmciOiJUcnVlIiwiRGF5c1JlbWFpbmluZyI6IjEiLCJTdGFydERhdGUiOiIyNi8wNC8yMDI0IDAwOjAwOjAwICswMTowMCIsIlNUUkVBTV9QT0xJQ1lfQVVUSE9SSVpBVElPTiI6InRydWUiLCJpYXQiOjE3Mjk4NDg4MjksIm5iZiI6MTcyOTg0ODgyOX0.ZigSD46YoSWSiozvGQXJ7FXgtEallqyTSvfcywCO_Z_d8cRlCJRb27bzJ1q4UtrBP99SBbttN2etmzyCZhhASAH55W4oo1Vh9iEbBu3uiH8ZPdBD8_V4v83djh70Fux0JUpQWcFq8bBsscXdg7fE2MpaRU004Ei3C03P3Es8jtsXRJ6rkkFFsa0NIQtPnmj44lZfAnU5A_BgamW6_OoPHjB1vEA9LUquQ5p7ovZxK1cv2lgs0lh3drYFyflqI1sAqJof4HCmMV1oK4U-1j9UhGov6J7TWtvSfbpiRToQayGe8yKmYEqydhQhgFlNBfjvv11Z_1uWyVyItopl7W5o9g" },
		{ "TCP_CLIENT_PLUGIN", "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJlc2RiIiwiaXNzIjoiZXNkYiIsImV4cCI6MTgyNDQ1NjgyOSwianRpIjoiM2RlZGU4YzktNTk2MS00OTY5LWExOGUtM2IyOWZjZTA3OTM2Iiwic3ViIjoiRVNEQiBUZXN0cyIsIklzVHJpYWwiOiJUcnVlIiwiSXNFeHBpcmVkIjoiRmFsc2UiLCJJc1ZhbGlkIjoiVHJ1ZSIsIklzRmxvYXRpbmciOiJUcnVlIiwiRGF5c1JlbWFpbmluZyI6IjEiLCJTdGFydERhdGUiOiIyNi8wNC8yMDI0IDAwOjAwOjAwICswMTowMCIsIlRDUF9DTElFTlRfUExVR0lOIjoidHJ1ZSIsImlhdCI6MTcyOTg0ODgyOSwibmJmIjoxNzI5ODQ4ODI5fQ.dLUmYsB_dygcHKd6roHSCbY3zycECwBeZscnu53jvJUo_OxDAWmw3ZeVigr8qHNH2v8GJbIhB49gcuCcOX3txTGTc_kcDxM4nlLec_hoUvNPFRgzYQ2dCFq8aukLJh_N-FBzg1SI7X5aK20bBBbrVqPykC6NOTuP0CBSKL8ZCf2UyIq9qr4TtL6IEZ7jEd1QHDPHv2T--XdXhRgdBhWaqa4HyUQlUy1MJ58_5jJ4EEL5cpTbZPWbWMC4UYx7AjpGxTn36kTdz4ApsEzUuepH6Ir7wycdxAXl64xMoktBNOAdcD6AElJSFUJP8qU0gge_40jGEJBDXBOBdoa6eqFbLQ" },
		{ "USER_CERTIFICATES", "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJlc2RiIiwiaXNzIjoiZXNkYiIsImV4cCI6MTgyNDQ1NjgyOSwianRpIjoiNTYyZDQxYjYtMDNhOC00NDcwLTg2YWMtNGZhODYyYzNkMDczIiwic3ViIjoiRVNEQiBUZXN0cyIsIklzVHJpYWwiOiJUcnVlIiwiSXNFeHBpcmVkIjoiRmFsc2UiLCJJc1ZhbGlkIjoiVHJ1ZSIsIklzRmxvYXRpbmciOiJUcnVlIiwiRGF5c1JlbWFpbmluZyI6IjEiLCJTdGFydERhdGUiOiIyNi8wNC8yMDI0IDAwOjAwOjAwICswMTowMCIsIlVTRVJfQ0VSVElGSUNBVEVTIjoidHJ1ZSIsImlhdCI6MTcyOTg0ODgyOSwibmJmIjoxNzI5ODQ4ODI5fQ.Zu-2tta3JPOsRD13GDM7LH6Wby24IQKlwyvDMQ_hFc5cFHfkmqoeFGuOO4C9yzbf2eWxbi_sDopm8CC0Cwkb2HGTkX1hpMxbJEdub5wnwsQG_rhqP8ljOUqcUYKCjtF04cFoCXF5PCTKH73KXMaCvE-BXoMhL0u8SU5wnNEw6g_qdLWf7I9JFauaPvBXE0VBH1F9hDtY1oVN2wR7VhGXtnAj8suU2nDVBRpSlQErGJqcHQXptQUXRx-QoUxNFsSmXSBeicUOKrYGwsEApnTSx7EKv-T68SbeQf-S_pRScJzxNvmB5B5Unq6oca1rNH55VyHWK0x-SVNYcNglpnuPCg" },
		{ "NONE", "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJlc2RiIiwiaXNzIjoiZXNkYiIsImV4cCI6MTgyNDQ1NjgyOSwianRpIjoiOTVmZTY2YzAtMDRkMi00MjExLWI1ZGQtNTAyM2MyYTAxMGFiIiwic3ViIjoiRVNEQiBUZXN0cyIsIklzVHJpYWwiOiJUcnVlIiwiSXNFeHBpcmVkIjoiRmFsc2UiLCJJc1ZhbGlkIjoiVHJ1ZSIsIklzRmxvYXRpbmciOiJUcnVlIiwiRGF5c1JlbWFpbmluZyI6IjEiLCJTdGFydERhdGUiOiIyNi8wNC8yMDI0IDAwOjAwOjAwICswMTowMCIsIk5PTkUiOiJ0cnVlIiwiaWF0IjoxNzI5ODQ4ODI5LCJuYmYiOjE3Mjk4NDg4Mjl9.R24i-ZAow3BhRaST3n25Uc_nQ184k83YRZZ0oRcWbU9B9XNLRH0Iegj0HmkyzkT50I4gcIJOIfcO6mIPp4Y959CP7aTAlt7XEnXoGF0GwsfXatAxy4iXG8Gpya7INgMoWEeN0v8eDH8_OVmnieOxeba9ex5j1oAW_FtQDMzcFjAeErpW__8zmkCsn6GzvlhdLE4e3r2wjshvrTTcS_1fvSVjQZov5ce2sVBJPegjCLO_QGiIBK9QTnpHrhe6KCYje6fSTjgty0V1Qj22bftvrXreYzQijPrnC_ek1BwV-A1JvacZugMCPIy8WvE5jE3hVYRWGGUzQZ-CibPGsjudYA" },
	};

	public class FakeLicenseService : ILicenseService {
		public FakeLicenseService(bool createLicense = true, string? entitlement = null) {
			var license = new License(new JsonWebToken(_hardCodedTokens[entitlement ?? "NONE"]));
			SelfLicense = license;

			if (createLicense) {
				CurrentLicense = license;
				Licenses = new BehaviorSubject<License>(license);
			} else {
				var licenses = new Subject<License>();
				licenses.OnError(new Exception("no license"));
				Licenses = licenses;
			}
		}

		public License SelfLicense { get; }

		public License? CurrentLicense { get; }

		public IObservable<License> Licenses { get; }

		public void RejectLicense(Exception ex) {
			RejectionException = ex;
		}

		public Exception? RejectionException { get; private set; }
	}
}
