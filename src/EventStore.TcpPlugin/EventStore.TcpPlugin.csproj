<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<ImplicitUsings>enable</ImplicitUsings>
		<Nullable>enable</Nullable>
	</PropertyGroup>

	<ItemGroup>
		<ProjectReference Include="..\..\EventStore\src\EventStore.Core\EventStore.Core.csproj" />
	</ItemGroup>

	<ItemGroup>
	  <None Update="tcp-plugin-example.yaml">
	    <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
	  </None>
	  <None Update="tcp-plugin-example.json">
	    <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
	  </None>
	</ItemGroup>

	<Target Name="PostBuild" AfterTargets="PostBuildEvent">
		<ItemGroup>
			<MySourceFiles Include="$(OutDir)\*.TcpPlugin.*" />
		</ItemGroup>
		<Copy SourceFiles="@(MySourceFiles)" DestinationFolder="..\..\EventStore\src\KurrentDB\$(OutDir)\plugins\$(ProjectName)" />
	</Target>

	<Target Name="PublishPlugin" AfterTargets="Publish">
		<ItemGroup>
			<PluginOutputFiles Include="$(PublishDir)\LICENSE.md" />
			<PluginOutputFiles Include="$(PublishDir)\NOTICE.html" />
			<PluginOutputFiles Include="$(PublishDir)\EventStore.TcpPlugin.deps.json" />
			<PluginOutputFiles Include="$(PublishDir)\EventStore.TcpPlugin.dll" />
		</ItemGroup>
		<Copy SourceFiles="@(PluginOutputFiles)" DestinationFolder="$(PublishDir)/package" />
	</Target>
</Project>
